<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <title>WebRTC Sample</title>
    <style>
      .fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: contain; /* 高さに依存して拡大縮小 */
        z-index: 999;
      }
      .video-container {
        position: relative;
      }
      .fullscreen-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .fullscreen-close {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        background-color: rgba(255, 0, 0, 0.8);
        color: white;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1001;
      }
    </style>
  </head>
  <body>
    <script type="module" src="/src/index.ts"></script>
    <div class="container mx-auto my-4 flex flex-col gap-8">
      <!-- ビデオ映像 -->
      <div class="grid grid-cols-2 gap-2">
        <div id="my-video-container" class="flex flex-col items-stretch">
          <p class="text-center text-lg">自分の映像</p>
          <video class="rounded-lg" id="my-video" autoplay></video>
          <button id="my-video-fullscreen" class="mt-2 px-4 py-2 rounded-lg bg-teal-400 text-white">
            画面いっぱいにする
          </button>
        </div>
        <div id="other-video-container" class="flex flex-col items-stretch">
          <p class="text-center text-lg">相手の映像</p>
          <video class="rounded-lg" id="other-video" autoplay></video>
          <button id="other-video-fullscreen" class="mt-2 px-4 py-2 rounded-lg bg-teal-400 text-white">
            画面いっぱいにする
          </button>
        </div>
      </div>
      <div class="mx-10 border-t-2 border-t-grey-300"></div>
      <!-- SDP関係 -->
      <div class="grid grid-cols-2 gap-2">
        <label class="flex flex-col items-center gap-2">
          <span class="text-lg">SDP Output</span>
          <textarea
            class="resize-none w-full rounded-lg border-2 border-grey-300 outline-teal-300"
            id="sdp-output"
            readonly
            rows="10"
          ></textarea>
          <button class="px-4 py-2 rounded-lg bg-teal-400 text-white" id="sdp-create-offer-button">
            SDP オファー発行
          </button>
        </label>
        <label class="flex flex-col items-center gap-2">
          <span class="text-lg">SDP Input</span>
          <textarea
            class="resize-none w-full rounded-lg border-2 border-grey-300 outline-teal-300"
            id="sdp-input"
            rows="10"
          ></textarea>
          <button class="px-4 py-2 rounded-lg bg-teal-400 text-white" id="sdp-receive-button">SDP 受け取り</button>
        </label>
      </div>
      <div class="mx-10 border-t-2 border-t-grey-300"></div>
      <!-- ICE Candidate関係 -->
      <div class="grid grid-cols-2 gap-2">
        <label class="flex flex-col items-center gap-2">
          <span class="text-lg">ICE Output</span>
          <textarea
            class="resize-none w-full rounded-lg border-2 border-grey-300 outline-teal-300"
            id="ice-output"
            readonly
            rows="10"
          ></textarea>
        </label>
        <label class="flex flex-col items-center gap-2">
          <span class="text-lg">ICE Input</span>
          <textarea
            class="resize-none w-full rounded-lg border-2 border-grey-300 outline-teal-300"
            id="ice-input"
            rows="10"
          ></textarea>
          <button class="px-4 py-2 rounded-lg bg-teal-400 text-white" id="ice-receive-button">ICE 受け取り</button>
        </label>
      </div>
    </div>

    <script>
      // 画面いっぱいにする機能のためのJavaScript
      const myVideo = document.getElementById("my-video");
      const otherVideo = document.getElementById("other-video");
      const myVideoContainer = document.getElementById("my-video-container");
      const otherVideoContainer = document.getElementById("other-video-container");
      const myVideoFullscreenButton = document.getElementById("my-video-fullscreen");
      const otherVideoFullscreenButton = document.getElementById("other-video-fullscreen");

      // フルスクリーン表示を切り替える関数
      function toggleFullscreen(videoElement, videoContainer, button) {
        const isFullscreen = videoElement.classList.contains("fullscreen");

        if (isFullscreen) {
          // フルスクリーン解除
          videoElement.classList.remove("fullscreen");
          videoContainer.style.position = ""; // 元の位置に戻す
          button.textContent = "画面いっぱいにする"; // ボタンのテキスト変更
          document.getElementById("fullscreen-container").remove(); // フルスクリーンモードの背景削除
        } else {
          // フルスクリーン表示
          videoElement.classList.add("fullscreen");
          videoContainer.style.position = "relative"; // 相対位置を設定
          button.textContent = "元に戻す"; // ボタンのテキスト変更

          // フルスクリーン用の背景を作成
          const fullscreenContainer = document.createElement("div");
          fullscreenContainer.id = "fullscreen-container";
          fullscreenContainer.classList.add("fullscreen-container");
          fullscreenContainer.innerHTML = `<button id="fullscreen-close" class="fullscreen-close">戻る</button>`;
          document.body.appendChild(fullscreenContainer);

          // 戻るボタンのイベントリスナー
          document.getElementById("fullscreen-close").addEventListener("click", () => {
            toggleFullscreen(videoElement, videoContainer, button);
          });
        }
      }

      // ボタンにイベントを追加
      myVideoFullscreenButton.addEventListener("click", () => {
        toggleFullscreen(myVideo, myVideoContainer, myVideoFullscreenButton);
      });

      otherVideoFullscreenButton.addEventListener("click", () => {
        toggleFullscreen(otherVideo, otherVideoContainer, otherVideoFullscreenButton);
      });
    </script>
  </body>
</html>
